"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5651],{4137:function(e,t,n){n.d(t,{Zo:function(){return h},kt:function(){return p}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},h=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),d=u(n),c=o,p=d["".concat(s,".").concat(c)]||d[c]||m[c]||r;return n?a.createElement(p,i(i({ref:t},h),{},{components:n})):a.createElement(p,i({ref:t},h))}));function p(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:o,i[1]=l;for(var u=2;u<r;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},1704:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return s},default:function(){return c},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return h}});var a=n(7462),o=n(3366),r=(n(7294),n(4137)),i=["components"],l={title:"Apache Pinot\u2122 0.12 - Configurable Time Boundary",author:"Mark Needham",author_title:"Mark Needham",author_url:"https://www.linkedin.com/in/lakshmanan-velusamy-a778a517/",author_image_url:"https://www.datocms-assets.com/75153/1661544338-mark-needham.png",description:"This post will explore the ability to configure the time boundary when working with hybrid tables.",keywords:["Apache Pinot","Apache Pinot 0.11.0","hybrid tables","time boundary"],tags:["Pinot","Data","Analytics","User-Facing Analytics","hybrid tables","time boundary"]},s=void 0,u={permalink:"/blog/2023/02/21/Apache-Pinot-0-12-Configurable-Time-Boundary",editUrl:"https://github.com/apache/pinot-site/edit/dev/website/blog/2023-02-21-Apache-Pinot-0-12-Configurable-Time-Boundary.md",source:"@site/blog/2023-02-21-Apache-Pinot-0-12-Configurable-Time-Boundary.md",title:"Apache Pinot\u2122 0.12 - Configurable Time Boundary",description:"This post will explore the ability to configure the time boundary when working with hybrid tables.",date:"2023-02-21T00:00:00.000Z",formattedDate:"February 21, 2023",tags:[{label:"Pinot",permalink:"/blog/tags/pinot"},{label:"Data",permalink:"/blog/tags/data"},{label:"Analytics",permalink:"/blog/tags/analytics"},{label:"User-Facing Analytics",permalink:"/blog/tags/user-facing-analytics"},{label:"hybrid tables",permalink:"/blog/tags/hybrid-tables"},{label:"time boundary",permalink:"/blog/tags/time-boundary"}],readingTime:3.415,truncated:!1,prevItem:{title:"Apache Pinot\u2122 0.12 - Consumer Record Lag",permalink:"/blog/2023/03/30/Apache-Pinot-0-12-Consumer-Record-Lag"},nextItem:{title:"Apache Pinot\u2122 0.11 - Deduplication on Real-Time Tables",permalink:"/blog/2023/01/29/Apache-Pinot-Deduplication-on-Real-Time-Tables"}},h=[{value:"What is a hybrid table?",id:"what-is-a-hybrid-table",children:[]},{value:"How do you query a hybrid table?",id:"how-do-you-query-a-hybrid-table",children:[]},{value:"So, what\u2019s the problem?",id:"so-whats-the-problem",children:[]},{value:"And the solution?",id:"and-the-solution",children:[]},{value:"Neat, anything else I should know?",id:"neat-anything-else-i-should-know",children:[]},{value:"Summary",id:"summary",children:[]}],d={toc:h},m="wrapper";function c(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://youtu.be/lB3RaKJ0Hbs"},(0,r.kt)("img",{parentName:"a",src:"https://i3.ytimg.com/vi/lB3RaKJ0Hbs/maxresdefault.jpg",alt:"Watch the video"}))),(0,r.kt)("p",null,"The Apache Pinot community recently released version ",(0,r.kt)("a",{parentName:"p",href:"https://docs.pinot.apache.org/basics/releases/0.12.0"},"0.12.0"),", which has lots of goodies for you to play with. This is the first in a series of blog posts showing off some of the new features in this release."),(0,r.kt)("p",null,"This post will explore the ability to configure the time boundary when working with hybrid tables."),(0,r.kt)("h2",{id:"what-is-a-hybrid-table"},"What is a hybrid table?"),(0,r.kt)("p",null,"A hybrid table is the term used to describe a situation where we have an offline and real-time table with the same name. The offline table stores historical data, while the real-time data continuously ingests data from a streaming data platform."),(0,r.kt)("h2",{id:"how-do-you-query-a-hybrid-table"},"How do you query a hybrid table?"),(0,r.kt)("p",null,"When you write a query against a hybrid table, the Pinot query engine needs to work out which records to read from the offline table and which to read from the real-time table."),(0,r.kt)("p",null,"It does this by computing the time boundary, determined by looking at the maximum end time of segments in the offline table and the segment ingestion frequency specified for the offline table."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"timeBoundary = <Maximum end time of offline segments> - <Ingestion Frequency>\n")),(0,r.kt)("p",null,"The ingestion frequency can either be 1 hour or 1 day, so one of these values will be used."),(0,r.kt)("p",null,"When a query for a hybrid table is received by a Pinot Broker, the broker sends a time boundary annotated version of the query to the offline and real-time tables. Any records from or before the time boundary are read from the offline table; anything greater than the boundary comes from the real-time table."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.datocms-assets.com/75153/1676991003-image2.png",alt:"Apache Pinot computing the time boundary",title:"Apache Pinot computing the time boundary"}),"  "),(0,r.kt)("p",null,"For example, if we executed the following query:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT count(*)\nFROM events\n")),(0,r.kt)("p",null,"The broker would send the following query to the offline table:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT count(*)\nFROM events_OFFLINE\nWHERE timeColumn <= $timeBoundary\n")),(0,r.kt)("p",null,"And the following query to the real-time table:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT count(*)\nFROM events_REALTIME\nWHERE timeColumn > $timeBoundary\n")),(0,r.kt)("p",null,"The results of the two queries are merged by the broker before being returned to the client."),(0,r.kt)("h2",{id:"so-whats-the-problem"},"So, what\u2019s the problem?"),(0,r.kt)("p",null,"If we have some overlap in the data in our offline and real-time tables, this approach works well, but if we have no overlap, we will end up with unexpected results."),(0,r.kt)("p",null,"For example, let\u2019s say that the most recent timestamp in the events offline table is 2023-01-09T18:41:17, our ingestion frequency is 1 hour, and the real-time table has data starting from 2023-01-09T18:41:18."),(0,r.kt)("p",null,"This will result in a boundary time of 2023-01-09T17:41:17, which means that any records with timestamps between 17:41 and 18:41 will be excluded from query results."),(0,r.kt)("h2",{id:"and-the-solution"},"And the solution?"),(0,r.kt)("p",null,"The 0.12 release sees the addition of the tables/{tableName}/timeBoundary API, which lets us set the time boundary to the maximum end time of all offline segments."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST \\\n  "http://localhost:9000/tables/{tableName}/timeBoundary" \\\n  -H "accept: application/json"\n')),(0,r.kt)("p",null,"In this case, that will result in a new boundary time of 2023-01-09T18:41:17, which is exactly what we need."),(0,r.kt)("p",null,"We\u2019ll then be able to query the events table and have it read the offline table to get all records on or before 2023-01-09T18:41:17 and the real-time table for everything else."),(0,r.kt)("h2",{id:"neat-anything-else-i-should-know"},"Neat, anything else I should know?"),(0,r.kt)("p",null,"Something to keep in mind when updating the time boundary is that it\u2019s a one-off operation. It won\u2019t be automatically updated if you add a new, more recent segment to the offline table."),(0,r.kt)("p",null,"In this scenario, you need to call the tables/{tableName}/timeBoundary API again."),(0,r.kt)("p",null,"And if you want to revert to the previous behavior where the time boundary is computed by subtracting the ingestion frequency from the latest end time, you can do that too:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X DELETE \\\n  "http://localhost:9000/tables/{tableName}/timeBoundary" \\\n  -H "accept: application/json"\n')),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"I love this feature, and it solves a problem I\u2019ve struggled with when using my datasets. I hope you\u2019ll find it just as useful."),(0,r.kt)("p",null,"Give it a try, and let us know how you get on. If you have any questions about this feature, feel free to join us on ",(0,r.kt)("a",{parentName:"p",href:"https://stree.ai/slack"},"Slack"),", where we\u2019ll be happy to help you out."))}c.isMDXComponent=!0}}]);